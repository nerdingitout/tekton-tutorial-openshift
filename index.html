
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <meta name="author" content="IBM Developer">
      
      
        <link rel="canonical" href="https://ibm.github.io/tekton-tutorial-openshift/">
      
      <link rel="shortcut icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.6">
    
    
      
        <title>Tekton 101 Workshop</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.cb6bc1d0.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.39b8e14a.min.css">
        
          
          
          <meta name="theme-color" content="#2094f3">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:300,400,400i,700%7CIBM+Plex+Mono&display=fallback">
        <style>body,input{font-family:"IBM Plex Sans",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"IBM Plex Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#openshift-deployment-using-tekton-pipelines" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://ibm.github.io/tekton-tutorial-openshift" title="Tekton 101 Workshop" class="md-header-nav__button md-logo" aria-label="Tekton 101 Workshop">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            Tekton 101 Workshop
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              Tekton Workshop
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/ibm/tekton-tutorial-openshift/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    tekton-tutorial-openshift
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://ibm.github.io/tekton-tutorial-openshift" title="Tekton 101 Workshop" class="md-nav__button md-logo" aria-label="Tekton 101 Workshop">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Tekton 101 Workshop
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/ibm/tekton-tutorial-openshift/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    tekton-tutorial-openshift
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Tekton Workshop
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="." class="md-nav__link md-nav__link--active">
        Tekton Workshop
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#estimated-time" class="md-nav__link">
    Estimated time
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#steps" class="md-nav__link">
    Steps
  </a>
  
    <nav class="md-nav" aria-label="Steps">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-tekton-pipeline-concepts" class="md-nav__link">
    1. Tekton pipeline concepts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-clone-the-repository" class="md-nav__link">
    2. Clone the repository
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-create-a-task-to-clone-the-git-repository" class="md-nav__link">
    3. Create a task to clone the Git repository
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-create-a-task-to-build-an-image-and-push-it-to-a-container-registry" class="md-nav__link">
    4. Create a task to build an image and push it to a container registry
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-create-a-task-to-deploy-an-image-to-a-kubernetes-cluster" class="md-nav__link">
    5. Create a task to deploy an image to a Kubernetes cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-create-a-pipeline" class="md-nav__link">
    6. Create a pipeline
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-define-a-service-account" class="md-nav__link">
    7. Define a service account
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-create-a-pipelinerun" class="md-nav__link">
    8. Create a PipelineRun
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9-run-the-pipeline" class="md-nav__link">
    9. Run the pipeline
  </a>
  
    <nav class="md-nav" aria-label="9. Run the pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#debugging-a-failed-pipelinerun" class="md-nav__link">
    Debugging a failed PipelineRun
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10-check-it-out-in-openshift-console" class="md-nav__link">
    10. Check it out in OpenShift Console
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#estimated-time" class="md-nav__link">
    Estimated time
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#steps" class="md-nav__link">
    Steps
  </a>
  
    <nav class="md-nav" aria-label="Steps">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-tekton-pipeline-concepts" class="md-nav__link">
    1. Tekton pipeline concepts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-clone-the-repository" class="md-nav__link">
    2. Clone the repository
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-create-a-task-to-clone-the-git-repository" class="md-nav__link">
    3. Create a task to clone the Git repository
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-create-a-task-to-build-an-image-and-push-it-to-a-container-registry" class="md-nav__link">
    4. Create a task to build an image and push it to a container registry
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-create-a-task-to-deploy-an-image-to-a-kubernetes-cluster" class="md-nav__link">
    5. Create a task to deploy an image to a Kubernetes cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-create-a-pipeline" class="md-nav__link">
    6. Create a pipeline
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-define-a-service-account" class="md-nav__link">
    7. Define a service account
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-create-a-pipelinerun" class="md-nav__link">
    8. Create a PipelineRun
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9-run-the-pipeline" class="md-nav__link">
    9. Run the pipeline
  </a>
  
    <nav class="md-nav" aria-label="9. Run the pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#debugging-a-failed-pipelinerun" class="md-nav__link">
    Debugging a failed PipelineRun
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10-check-it-out-in-openshift-console" class="md-nav__link">
    10. Check it out in OpenShift Console
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/ibm/tekton-tutorial-openshift/edit/master/docs/README.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="openshift-deployment-using-tekton-pipelines">OpenShift Deployment using Tekton Pipelines<a class="headerlink" href="#openshift-deployment-using-tekton-pipelines" title="Permanent link">&para;</a></h1>
<p>Tekton is an open source project to configure and run CI/CD pipelines within a OpenShift/Kubernetes cluster.</p>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>In this tutorial you'll learn</p>
<ul>
<li>what are the basic concepts used by Tekton pipelines</li>
<li>how to create a pipeline to build and deploy a container</li>
<li>how to run the pipeline, check its status and troubleshoot problems</li>
</ul>
<p>Also, check out this <a href="https://github.com/openshift/pipelines-tutorial">very good tutorial</a> by Red Hat.</p>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h2>
<p>Before you start the tutorial you must set up a OpenShift environment with Tekton installed.</p>
<p>Follow <a href="https://github.com/openshift/pipelines-tutorial/blob/master/install-operator.md">this guide on installing OpenShift Pipelines</a></p>
<p>Create a route for the OpenShift registry if you have not done so already.</p>
<div class="highlight"><pre><span></span><code><span class="go">oc patch configs.imageregistry.operator.openshift.io/cluster --patch &#39;{&quot;spec&quot;:{&quot;defaultRoute&quot;:true}}&#39; --type=merge</span>
</code></pre></div>
<h2 id="estimated-time">Estimated time<a class="headerlink" href="#estimated-time" title="Permanent link">&para;</a></h2>
<p>1 hour</p>
<h2 id="steps">Steps<a class="headerlink" href="#steps" title="Permanent link">&para;</a></h2>
<h3 id="1-tekton-pipeline-concepts">1. Tekton pipeline concepts<a class="headerlink" href="#1-tekton-pipeline-concepts" title="Permanent link">&para;</a></h3>
<p>Tekton provides a set of extensions to Kubernetes, in the form of <a href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/">Custom Resources</a>, for defining pipelines.
The following diagram shows the resources used in this tutorial.  The arrows depict references from one resource to another resource.</p>
<p><img alt="crd" src="images/crd.png" /></p>
<p>The resources are used as follows.</p>
<ul>
<li>A <strong>PipelineRun</strong> defines an execution of a pipeline.  It references the <strong>Pipeline</strong> to run.</li>
<li>A <strong>Pipeline</strong> defines the set of <strong>Tasks</strong> that compose a pipeline.</li>
<li>A <strong>Task</strong> defines a set of build steps such as compiling code, running tests, and building and deploying images.</li>
</ul>
<p>We will go into more detail about each resource during the walkthrough of the example.</p>
<p>Let's create a simple pipeline that</p>
<ul>
<li>builds a Docker image from source files and pushes it to your private container registry</li>
<li>deploys the image to your Kubernetes cluster</li>
</ul>
<h3 id="2-clone-the-repository">2. Clone the repository<a class="headerlink" href="#2-clone-the-repository" title="Permanent link">&para;</a></h3>
<p>You should clone this project to your workstation since you will need to edit some of the yaml files before applying them to your cluster.
Check out the <code>beta-update</code> branch after cloning.</p>
<div class="highlight"><pre><span></span><code>git clone https://github.com/IBM/tekton-tutorial-openshift
<span class="nb">cd</span> tekton-tutorial-openshift
</code></pre></div>
<p>We will work from the bottom-up, i.e. first we will define the Task resources needed to build and deploy the image,
then we'll define the Pipeline resource that references the tasks,
and finally we'll create the PipelineRun resource needed to run the pipeline.</p>
<h3 id="3-create-a-task-to-clone-the-git-repository">3. Create a task to clone the Git repository<a class="headerlink" href="#3-create-a-task-to-clone-the-git-repository" title="Permanent link">&para;</a></h3>
<p>The first thing that the pipeline needs is a task to clone the Git repository that the pipeline is building.
This is such a common function that you don't need to write this task yourself.
Tekton provides a library of reusable tasks called the <a href="https://github.com/tektoncd/catalog">Tekton catalog</a>.
It provides a <code>git-clone</code> task which is described <a href="https://github.com/tektoncd/catalog/tree/v1beta1/git#git-clone">here</a>.</p>
<p>The task is reproduced below so that we can talk about it.</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tekton.dev/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Task</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">git-clone</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">workspaces</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">output</span>
    <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">The git repo will be cloned onto the volume backing this workspace</span>
  <span class="nt">params</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">url</span>
    <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">git url to clone</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">revision</span>
    <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">git revision to checkout (branch, tag, sha, ref�)</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
    <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">master</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">submodules</span>
    <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">defines if the resource should initialize and fetch the submodules</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
    <span class="nt">default</span><span class="p">:</span> <span class="s">&quot;true&quot;</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">depth</span>
    <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">performs a shallow clone where only the most recent commit(s) will be fetched</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
    <span class="nt">default</span><span class="p">:</span> <span class="s">&quot;1&quot;</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sslVerify</span>
    <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">defines if http.sslVerify should be set to true or false in the global git config</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
    <span class="nt">default</span><span class="p">:</span> <span class="s">&quot;true&quot;</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">subdirectory</span>
    <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">subdirectory inside the &quot;output&quot; workspace to clone the git repo into</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
    <span class="nt">default</span><span class="p">:</span> <span class="s">&quot;src&quot;</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">deleteExisting</span>
    <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">clean out the contents of the repo&#39;s destination directory (if it already exists) before trying to clone the repo there</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
    <span class="nt">default</span><span class="p">:</span> <span class="s">&quot;false&quot;</span>
  <span class="nt">results</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">commit</span>
    <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">The precise commit SHA that was fetched by this Task</span>
  <span class="nt">steps</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">clone</span>
    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">gcr.io/tekton-releases/github.com/tektoncd/pipeline/cmd/git-init:latest</span>
    <span class="nt">script</span><span class="p">:</span> <span class="p p-Indicator">|</span>
      <span class="no">CHECKOUT_DIR=&quot;$(workspaces.output.path)/$(params.subdirectory)&quot;</span>

      <span class="no">cleandir() {</span>
        <span class="no"># Delete any existing contents of the repo directory if it exists.</span>
        <span class="no">#</span>
        <span class="no"># We don&#39;t just &quot;rm -rf $CHECKOUT_DIR&quot; because $CHECKOUT_DIR might be &quot;/&quot;</span>
        <span class="no"># or the root of a mounted volume.</span>
        <span class="no">if [[ -d &quot;$CHECKOUT_DIR&quot; ]] ; then</span>
          <span class="no"># Delete non-hidden files and directories</span>
          <span class="no">rm -rf &quot;$CHECKOUT_DIR&quot;/*</span>
          <span class="no"># Delete files and directories starting with . but excluding ..</span>
          <span class="no">rm -rf &quot;$CHECKOUT_DIR&quot;/.[!.]*</span>
          <span class="no"># Delete files and directories starting with .. plus any other character</span>
          <span class="no">rm -rf &quot;$CHECKOUT_DIR&quot;/..?*</span>
        <span class="no">fi</span>
      <span class="no">}</span>

      <span class="no">if [[ &quot;$(params.deleteExisting)&quot; == &quot;true&quot; ]] ; then</span>
        <span class="no">cleandir</span>
      <span class="no">fi</span>

      <span class="no">/ko-app/git-init \</span>
        <span class="no">-url &quot;$(params.url)&quot; \</span>
        <span class="no">-revision &quot;$(params.revision)&quot; \</span>
        <span class="no">-path &quot;$CHECKOUT_DIR&quot; \</span>
        <span class="no">-sslVerify=&quot;$(params.sslVerify)&quot; \</span>
        <span class="no">-submodules=&quot;$(params.submodules)&quot; \</span>
        <span class="no">-depth=&quot;$(params.depth)&quot;</span>
      <span class="no">cd &quot;$CHECKOUT_DIR&quot;</span>
      <span class="no">RESULT_SHA=&quot;$(git rev-parse HEAD | tr -d &#39;\n&#39;)&quot;</span>
      <span class="no">EXIT_CODE=&quot;$?&quot;</span>
      <span class="no">if [ &quot;$EXIT_CODE&quot; != 0 ]</span>
      <span class="no">then</span>
        <span class="no">exit $EXIT_CODE</span>
      <span class="no">fi</span>
      <span class="no"># Make sure we don&#39;t add a trailing newline to the result!</span>
      <span class="no">echo -n &quot;$RESULT_SHA&quot; &gt; $(results.commit.path)</span>
</code></pre></div>
<p>A task can have one or more steps.  Each step defines an image to run to perform the function of the step.
This task has one step that uses a Tekton-provided container to clone a Git repo.</p>
<p>A task can have parameters.  Parameters help to make a task reusable.
This task accepts many parameters such as:</p>
<ul>
<li>the URL of the Git repository to clone</li>
<li>the revision to check out</li>
</ul>
<p>Parameters can have default values provided by the task or the values can be provided by the <code>Pipeline</code> and <code>PipelineRun</code> resources that we'll see later.
Steps can reference parameter values by using the syntax <code>$(params.name)</code> where <code>name</code> is the name of the parameter.
For example the step uses <code>$(params.url)</code> to reference the <code>url</code> parameter value.</p>
<p>The task requires a workspace where the clone is stored.
From the point of view of the task, a workspace provides a file system path where it can read or write data.
Steps can reference the path using the syntax <code>$(workspaces.name.path)</code> where <code>name</code> is the name of the workspace.
We'll see later how the workspace becomes associated with a storage volume.</p>
<p>Apply the file to your cluster to create the task.</p>
<div class="highlight"><pre><span></span><code>kubectl apply -f https://raw.githubusercontent.com/tektoncd/catalog/v1beta1/git/git-clone.yaml
</code></pre></div>
<h3 id="4-create-a-task-to-build-an-image-and-push-it-to-a-container-registry">4. Create a task to build an image and push it to a container registry<a class="headerlink" href="#4-create-a-task-to-build-an-image-and-push-it-to-a-container-registry" title="Permanent link">&para;</a></h3>
<p>The next function that the pipeline needs is a task that builds a docker image and pushes it to a container registry.
The catalog provides a <code>kaniko</code> task which does this using Google's <code>kaniko</code> tool.
The task is described <a href="https://github.com/tektoncd/catalog/tree/v1beta1/kaniko">here</a>.</p>
<p>The task is reproduced below.</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tekton.dev/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Task</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kaniko</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">params</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">IMAGE</span>
    <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Name (reference) of the image to build.</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DOCKERFILE</span>
    <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Path to the Dockerfile to build.</span>
    <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./Dockerfile</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CONTEXT</span>
    <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">The build context used by Kaniko.</span>
    <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">EXTRA_ARGS</span>
    <span class="nt">default</span><span class="p">:</span> <span class="s">&quot;&quot;</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">BUILDER_IMAGE</span>
    <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">The image on which builds will run</span>
    <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">gcr.io/kaniko-project/executor:latest</span>
  <span class="nt">workspaces</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">source</span>
  <span class="nt">results</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">IMAGE-DIGEST</span>
    <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Digest of the image just built.</span>

  <span class="nt">steps</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">build-and-push</span>
    <span class="nt">workingDir</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">$(workspaces.source.path)</span>
    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">$(params.BUILDER_IMAGE)</span>
    <span class="c1"># specifying DOCKER_CONFIG is required to allow kaniko to detect docker credential</span>
    <span class="c1"># https://github.com/tektoncd/pipeline/pull/706</span>
    <span class="nt">env</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DOCKER_CONFIG</span>
      <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/tekton/home/.docker</span>
    <span class="nt">command</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/kaniko/executor</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">$(params.EXTRA_ARGS)</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--dockerfile=$(params.DOCKERFILE)</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--context=$(workspaces.source.path)/$(params.CONTEXT)</span>  <span class="c1"># The user does not need to care the workspace and the source.</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--destination=$(params.IMAGE)</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">--oci-layout-path=$(workspaces.source.path)/image-digest</span>
    <span class="nt">securityContext</span><span class="p">:</span>
      <span class="nt">runAsUser</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">write-digest</span>
    <span class="nt">workingDir</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">$(workspaces.source.path)</span>
    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">gcr.io/tekton-releases/github.com/tektoncd/pipeline/cmd/imagedigestexporter:v0.11.1</span>
    <span class="c1"># output of imagedigestexport [{&quot;key&quot;:&quot;digest&quot;,&quot;value&quot;:&quot;sha256:eed29..660&quot;,&quot;resourceRef&quot;:{&quot;name&quot;:&quot;myrepo/myimage&quot;}}]</span>
    <span class="nt">command</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;/ko-app/imagedigestexporter&quot;</span><span class="p p-Indicator">]</span>
    <span class="nt">args</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">-images=[{&quot;name&quot;:&quot;$(params.IMAGE)&quot;,&quot;type&quot;:&quot;image&quot;,&quot;url&quot;:&quot;$(params.IMAGE)&quot;,&quot;digest&quot;:&quot;&quot;,&quot;OutputImageDir&quot;:&quot;$(workspaces.source.path)/image-digest&quot;}]</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">-terminationMessagePath=image-digested</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">digest-to-results</span>
    <span class="nt">workingDir</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">$(workspaces.source.path)</span>
    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">stedolan/jq</span>
    <span class="nt">script</span><span class="p">:</span> <span class="p p-Indicator">|</span>
      <span class="no">cat image-digested | jq -j &#39;.[0].value&#39; | tee /tekton/results/IMAGE-DIGEST</span>
</code></pre></div>
<p>You can see that this task needs a workspace as well.
This workspace has the source to build.
The pipeline will provide the same workspace that it used for the <code>git-clone</code> task.</p>
<p>The <code>kaniko</code> task also uses a feature called results.
A result is a value produced by a task which can then be used as a parameter value to other tasks.
This task declares a result named <code>IMAGE-DIGEST</code> which it sets to the digest of the built image.
A task sets a result by writing it to a file named <code>/tekton/results/name</code> where <code>name</code> is the name of the result, in this case <code>IMAGE-DIGEST</code>.
We will see later how the pipeline uses this result.</p>
<p>You may be wondering about how the task authenticates to the image repository for permission to push the image.
This will be covered later on in the tutorial.</p>
<p>Apply the file to your cluster to create the task.</p>
<div class="highlight"><pre><span></span><code>kubectl apply -f https://raw.githubusercontent.com/tektoncd/catalog/v1beta1/kaniko/kaniko.yaml
</code></pre></div>
<h3 id="5-create-a-task-to-deploy-an-image-to-a-kubernetes-cluster">5. Create a task to deploy an image to a Kubernetes cluster<a class="headerlink" href="#5-create-a-task-to-deploy-an-image-to-a-kubernetes-cluster" title="Permanent link">&para;</a></h3>
<p>The final function that the pipeline needs is a task that deploys a docker image to a Kubernetes cluster.
Below is a Tekton task that does this.
You can find this yaml file at <a href="https://github.com/IBM/tekton-tutorial-openshift/blob/master/tekton/tasks/deploy-using-kubectl.yaml">tekton/tasks/deploy-using-kubectl.yaml</a>.</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tekton.dev/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Task</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">deploy-using-kubectl</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">workspaces</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">git-source</span>
      <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">The git repo</span>
  <span class="nt">params</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pathToYamlFile</span>
      <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">The path to the yaml file to deploy within the git source</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">imageUrl</span>
      <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Image name including repository</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">imageTag</span>
      <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Image tag</span>
      <span class="nt">default</span><span class="p">:</span> <span class="s">&quot;latest&quot;</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">imageDigest</span>
      <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Digest of the image to be used.</span>
  <span class="nt">steps</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">update-yaml</span>
      <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">alpine</span>
      <span class="nt">command</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;sed&quot;</span><span class="p p-Indicator">]</span>
      <span class="nt">args</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="s">&quot;-i&quot;</span>
        <span class="p p-Indicator">-</span> <span class="s">&quot;-e&quot;</span>
        <span class="p p-Indicator">-</span> <span class="s">&quot;s;__IMAGE__;$(params.imageUrl):$(params.imageTag);g&quot;</span>
        <span class="p p-Indicator">-</span> <span class="s">&quot;-e&quot;</span>
        <span class="p p-Indicator">-</span> <span class="s">&quot;s;__DIGEST__;$(params.imageDigest);g&quot;</span>
        <span class="p p-Indicator">-</span> <span class="s">&quot;$(workspaces.git-source.path)/$(params.pathToYamlFile)&quot;</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">run-kubectl</span>
      <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lachlanevenson/k8s-kubectl</span>
      <span class="nt">command</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;kubectl&quot;</span><span class="p p-Indicator">]</span>
      <span class="nt">args</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="s">&quot;apply&quot;</span>
        <span class="p p-Indicator">-</span> <span class="s">&quot;-f&quot;</span>
        <span class="p p-Indicator">-</span> <span class="s">&quot;$(workspaces.git-source.path)/$(params.pathToYamlFile)&quot;</span>
</code></pre></div>
<p>This task has two steps.</p>
<ol>
<li>
<p>The first step runs <code>sed</code> in an Alpine Linux container to update the yaml file used for deployment with the image that was built by the <code>kaniko</code> task. The step requires the yaml file to have two character strings, <code>__IMAGE__</code> and <code>__DIGEST__</code>, which are substituted with parameter values.</p>
</li>
<li>
<p>The second step runs <code>kubectl</code> using Lachlan Evenson's popular <code>k8s-kubectl</code> container image to apply the yaml file to the same cluster where the pipeline is running.</p>
</li>
</ol>
<p>As was the case in the git-clone and kaniko tasks, this task makes use of parameters in order to make the task as reusable as possible.
It also needs the workspace to get the deployment yaml file.</p>
<p>You may be wondering about how the task authenticates to the cluster for permission to apply the resource(s) in the yaml file.
This will be covered later on in the tutorial.</p>
<p>Apply the file to your cluster to create the task.</p>
<div class="highlight"><pre><span></span><code>kubectl apply -f tekton/tasks/deploy-using-kubectl.yaml
</code></pre></div>
<h3 id="6-create-a-pipeline">6. Create a pipeline<a class="headerlink" href="#6-create-a-pipeline" title="Permanent link">&para;</a></h3>
<p>Below is a Tekton pipeline that runs the tasks we defined above.
You can find this yaml file at <a href="https://github.com/IBM/tekton-tutorial-openshift/blob/master/tekton/pipeline/build-and-deploy-pipeline.yaml">tekton/pipeline/build-and-deploy-pipeline.yaml</a>.</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tekton.dev/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Pipeline</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">build-and-deploy-pipeline</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">workspaces</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">git-source</span>
      <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">The git repo</span>
  <span class="nt">params</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">gitUrl</span>
      <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Git repository url</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pathToContext</span>
      <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">The path to the build context, used by Kaniko - within the workspace</span>
      <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">src</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pathToYamlFile</span>
      <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">The path to the yaml file to deploy within the git source</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">imageUrl</span>
      <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Image name including repository</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">imageTag</span>
      <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Image tag</span>
      <span class="nt">default</span><span class="p">:</span> <span class="s">&quot;latest&quot;</span>
  <span class="nt">tasks</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">clone-repo</span>
      <span class="nt">taskRef</span><span class="p">:</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">git-clone</span>
      <span class="nt">workspaces</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">output</span>
          <span class="nt">workspace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">git-source</span>
      <span class="nt">params</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">url</span>
          <span class="nt">value</span><span class="p">:</span> <span class="s">&quot;$(params.gitUrl)&quot;</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">subdirectory</span>
          <span class="nt">value</span><span class="p">:</span> <span class="s">&quot;.&quot;</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">deleteExisting</span>
          <span class="nt">value</span><span class="p">:</span> <span class="s">&quot;true&quot;</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">source-to-image</span>
      <span class="nt">taskRef</span><span class="p">:</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kaniko</span>
      <span class="nt">runAfter</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">clone-repo</span>
      <span class="nt">workspaces</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">source</span>
          <span class="nt">workspace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">git-source</span>
      <span class="nt">params</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">CONTEXT</span>
          <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">$(params.pathToContext)</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">IMAGE</span>
          <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">$(params.imageUrl):$(params.imageTag)</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">deploy-to-cluster</span>
      <span class="nt">taskRef</span><span class="p">:</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">deploy-using-kubectl</span>
      <span class="nt">workspaces</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">git-source</span>
          <span class="nt">workspace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">git-source</span>
      <span class="nt">params</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pathToYamlFile</span>
          <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">$(params.pathToYamlFile)</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">imageUrl</span>
          <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">$(params.imageUrl)</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">imageTag</span>
          <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">$(params.imageTag)</span>
        <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">imageDigest</span>
          <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">$(tasks.source-to-image.results.IMAGE-DIGEST)</span>
</code></pre></div>
<p>A Pipeline resource contains a list of tasks to run.
Each pipeline task is assigned a <code>name</code> within the pipeline;  here they are <code>clone-repo</code>, <code>source-to-image</code>, and <code>deploy-using-kubectl</code>.</p>
<p>The pipeline configures each task via the task's parameters.
You can choose whether to expose a task parameter as a pipeline parameter, set the value directly, or let the value
default inside the task (if it's an optional parameter).  For example this pipeline exposes the <code>CONTEXT</code> parameter from the
kaniko task (under a different name, <code>pathToContext</code>) but does not expose the <code>DOCKERFILE</code> parameter and allows it to default inside the task.</p>
<p>This pipeline also shows how to take the result of one task and pass it to another task.
We saw earlier that the <code>kaniko</code> task produces a result named <code>IMAGE-DIGEST</code> that holds the digest of the built image.
The pipeline passes that value to the <code>deploy-using-kubectl</code> task by using the syntax <code>$(tasks.source-to-image.results.IMAGE-DIGEST)</code>
where <code>source-to-image</code> is the name used in the pipeline to run the <code>kaniko</code> task.</p>
<p>By default Tekton assumes that pipeline tasks can be executed concurrently.
In this pipeline each pipeline task depends on the previous one so they must be executed sequentially.
One way that dependencies between pipeline tasks can be expressed is by using the <code>runAfter</code> key.
It specifies that the task must run after the given list of tasks has completed.
In this example, the pipeline specifies that the <code>source-to-image</code> pipeline task must run after the <code>clone-repo</code> pipeline task.</p>
<p>The <code>deploy-using-kubectl</code> pipeline task must run after the <code>source-to-image</code> pipeline task but it doesn't need to specify the <code>runAfter</code> key.
This is because it references a task result from the <code>source-to-image</code> pipeline task
and Tekton is smart enough to figure out that this means it must run after that task.</p>
<p>Apply the file to your cluster to create the pipeline.</p>
<div class="highlight"><pre><span></span><code>kubectl apply -f tekton/pipeline/build-and-deploy-pipeline.yaml
</code></pre></div>
<h3 id="7-define-a-service-account">7. Define a service account<a class="headerlink" href="#7-define-a-service-account" title="Permanent link">&para;</a></h3>
<p>Before running the pipeline, we need to set up a service account so that it can access protected resources.
The service account ties together a couple of secrets containing credentials for authentication
along with RBAC-related resources for permission to create and modify certain Kubernetes resources.</p>
<p>The 3<sup>rd</sup> command will create a secret that contains credentials for accessing the internal OpenShift image registry</p>
<p>Next, run the <code>get routes</code> command to view the registry endpoint. Copy it and insert it into the command after that replacing <code>&lt;Registry route&gt;</code>. Then, replace <code>&lt;your IBM ID&gt;</code> with the email address you used for the IBM Cloud account.</p>
<div class="highlight"><pre><span></span><code>kubectl get routes -n openshift-image-registry

<span class="nb">export</span> <span class="nv">REGISTRY</span><span class="o">=</span>&lt;Registry route&gt;
<span class="nb">export</span> <span class="nv">EMAIL</span><span class="o">=</span>&lt;your IBM ID&gt;

kubectl create secret generic ibm-registry-secret --type<span class="o">=</span><span class="s2">&quot;kubernetes.io/basic-auth&quot;</span> --from-literal<span class="o">=</span><span class="nv">username</span><span class="o">=</span><span class="k">$(</span>oc whoami<span class="k">)</span> --from-literal<span class="o">=</span><span class="nv">password</span><span class="o">=</span><span class="k">$(</span>oc whoami -t<span class="k">)</span>

kubectl create secret docker-registry pull-secret --docker-server<span class="o">=</span><span class="nv">$REGISTRY</span> --docker-username<span class="o">=</span><span class="k">$(</span>oc whoami<span class="k">)</span> --docker-password<span class="o">=</span><span class="k">$(</span>oc whoami -t<span class="k">)</span> --docker-email<span class="o">=</span><span class="nv">$EMAIL</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>kubectl annotate secret ibm-registry-secret tekton.dev/docker-0<span class="o">=</span><span class="nv">$REGISTRY</span>
</code></pre></div>
<p>This secret will be used to both push and pull images from your registry.</p>
<p>Now you can create the service account using the following yaml.
You can find this yaml file at <a href="https://github.com/IBM/tekton-tutorial-openshift/blob/master/tekton/pipeline-account.yaml">tekton/pipeline-account.yaml</a>.</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pipeline-account</span>
<span class="nt">secrets</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ibm-registry-secret</span>

<span class="nn">---</span>

<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Secret</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kube-api-secret</span>
  <span class="nt">annotations</span><span class="p">:</span>
    <span class="nt">kubernetes.io/service-account.name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pipeline-account</span>
<span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kubernetes.io/service-account-token</span>

<span class="nn">---</span>

<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Role</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pipeline-role</span>
<span class="nt">rules</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">apiGroups</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;&quot;</span><span class="p p-Indicator">]</span>
  <span class="nt">resources</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;services&quot;</span><span class="p p-Indicator">]</span>
  <span class="nt">verbs</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;get&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;create&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;update&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;patch&quot;</span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span> <span class="nt">apiGroups</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;apps&quot;</span><span class="p p-Indicator">]</span>
  <span class="nt">resources</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;deployments&quot;</span><span class="p p-Indicator">]</span>
  <span class="nt">verbs</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;get&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;create&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;update&quot;</span><span class="p p-Indicator">,</span> <span class="s">&quot;patch&quot;</span><span class="p p-Indicator">]</span>

<span class="nn">---</span>

<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">RoleBinding</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pipeline-role-binding</span>
<span class="nt">roleRef</span><span class="p">:</span>
  <span class="nt">apiGroup</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
  <span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Role</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pipeline-role</span>
<span class="nt">subjects</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pipeline-account</span>
</code></pre></div>
<p>This yaml creates the following Kubernetes resources:</p>
<ul>
<li>
<p>A ServiceAccount named <code>pipeline-account</code>. The service account references the <code>ibm-registry-secret</code> secret so that the pipeline can authenticate to your private container registry when it pushes and pulls a container image.</p>
</li>
<li>
<p>A Secret named <code>kube-api-secret</code> which contains an API credential (generated by Kubernetes) for accessing the Kubernetes API. This allows the pipeline to use <code>kubectl</code> to talk to your cluster.</p>
</li>
<li>
<p>A Role named <code>pipeline-role</code> and a RoleBinding named <code>pipeline-role-binding</code> which provide the resource-based access control permissions needed for this pipeline to create and modify Kubernetes resources.</p>
</li>
</ul>
<p>Apply the file to your cluster to create the service account and related resources.</p>
<div class="highlight"><pre><span></span><code>kubectl apply -f tekton/pipeline-account.yaml
</code></pre></div>
<h3 id="8-create-a-pipelinerun">8. Create a PipelineRun<a class="headerlink" href="#8-create-a-pipelinerun" title="Permanent link">&para;</a></h3>
<p>We've defined reusable Pipeline and Task resources for building and deploying an image.
It is now time to look at how one runs the pipeline.</p>
<p>Below is a Tekton PipelineRun resource that runs the pipeline we defined above.
You can find this yaml file at <a href="https://github.com/IBM/tekton-tutorial-openshift/blob/master/tekton/picalc-pipeline-pvc.yaml">tekton/run/picalc-pipeline-run.yaml</a>.</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tekton.dev/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PipelineRun</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">generateName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">picalc-pr-</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">pipelineRef</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">build-and-deploy-pipeline</span>
  <span class="nt">params</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">gitUrl</span>
      <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">https://github.com/odrodrig/tekton-tutorial</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pathToYamlFile</span>
      <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kubernetes/picalc.yaml</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">imageUrl</span>
      <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;REGISTRY&gt;/default/picalc</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">imageTag</span>
      <span class="nt">value</span><span class="p">:</span> <span class="s">&quot;1.0&quot;</span>
  <span class="nt">serviceAccountName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pipeline-account</span>
  <span class="nt">workspaces</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">git-source</span>
      <span class="nt">persistentVolumeClaim</span><span class="p">:</span>
        <span class="nt">claimName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">picalc-source-pvc</span>
</code></pre></div>
<p>Although this file is small there is a lot going on here.  Let's break it down from top to bottom:</p>
<ul>
<li>
<p>The PipelineRun does not have a fixed name.  It uses <code>generateName</code> to generate a name each time it is created. This is because a particular PipelineRun resource executes the pipeline only once.  If you want to run the pipeline again, you cannot modify an existing PipelineRun resource to request it to re-run -- you must create a new PipelineRun resource. While you could use <code>name</code> to assign a unique name to your PipelineRun each time you create one, it is much easier to use <code>generateName</code>.</p>
</li>
<li>
<p>The Pipeline resource is identified under the <code>pipelineRef</code> key.</p>
</li>
<li>
<p>Parameters exposed by the pipeline are set to specific values such as the Git repository to clone, the image to build, and the yaml file to deploy. This example builds a <a href="https://github.com/IBM/tekton-tutorial-openshift/blob/master/src/picalc.go">go program that calculates an approximation of pi</a>. The source includes a <a href="src/Dockerfile">Dockerfile</a> which runs tests, compiles the code, and builds an image for execution.</p>
</li>
</ul>
<blockquote>
<p><strong>NOTE</strong> <em>You must edit</em> the <code>picalc-pipeline-run.yaml</code> file to substitute the values of <code>&lt;REGISTRY&gt;</code> with the information for your private container registry. To find the value for <code>&lt;REGISTRY&gt;</code>, enter the command <code>oc get routes -n openshift-image-registry</code>.</p>
</blockquote>
<ul>
<li>
<p>The service account named <code>pipeline-account</code> which we created earlier is specified to provide the credentials needed for the pipeline to run successfully.</p>
</li>
<li>
<p>The workspace used by the pipeline to clone the Git repository is mapped to a persistent volume claim which is a request for a storage volume.</p>
</li>
</ul>
<p>Before you run the pipeline for the first time, you must create the persistent volume claim for the workspace.</p>
<div class="highlight"><pre><span></span><code>kubectl create -f tekton/picalc-pipeline-pvc.yaml
</code></pre></div>
<p>The persistent volume claim requests Kubernetes to obtain a storage volume.
Since each PipelineRun references the same claim and thus the same volume, this means the PipelineRun can only be run serially to avoid conflicting use of the volume.
There is <a href="https://github.com/tektoncd/pipeline/pull/2326">funtionality coming in Tekton</a> to allow each PipelineRun to create its own persistent volume claim and thus use its own volume.</p>
<p>Check that the persistent volume claim is bound before continuing.</p>
<div class="highlight"><pre><span></span><code>$ kubectl get pvc picalc-source-pvc
NAME                STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS       AGE
picalc-source-pvc   Bound    pvc-662946bc-57f2-4ba5-982c-b0fa9db1d065   20Gi       RWO            ibmc-file-bronze   2m
</code></pre></div>
<h3 id="9-run-the-pipeline">9. Run the pipeline<a class="headerlink" href="#9-run-the-pipeline" title="Permanent link">&para;</a></h3>
<p>All the pieces are in place to run the pipeline.</p>
<div class="highlight"><pre><span></span><code>$ kubectl create -f tekton/run/picalc-pipeline-run.yaml
pipelinerun.tekton.dev/picalc-pr-c7hsb created
</code></pre></div>
<p>Note that we're using <code>kubectl create</code> here instead of <code>kubectl apply</code>.
As mentioned previously a given PipelineRun resource can run a pipeline only once so you need to create a new one each time you want to run the pipeline.
<code>kubectl</code> will respond with the generated name of the PipelineRun resource.</p>
<p>&lt;!-- Let's use the <code>tkn</code> CLI to check the status of the PipelineRun.
While you can check the status of the pipeline using the <code>kubectl describe</code> command, the <code>tkn</code> cli provides much nicer output.</p>
<div class="highlight"><pre><span></span><code>$ tkn pipelinerun describe picalc-pr-c7hsb
Name:              picalc-pr-c7hsb
Namespace:         default
Pipeline Ref:      build-and-deploy-pipeline
Service Account:   pipeline-account

Status

STARTED         DURATION   STATUS
2 minutes ago   ---        Running

Resources

 No resources

Params

 NAME             VALUE
 gitUrl           https://github.com/IBM/tekton-tutorial
 pathToYamlFile   kubernetes/picalc.yaml
 imageUrl         us.icr.io/gregd/picalc
 imageTag         1.0

Taskruns

 NAME                                    TASK NAME         STARTED          DURATION   STATUS
 picalc-pr-c7hsb-source-to-image-s8rrg   source-to-image   56 seconds ago   ---        Running
 picalc-pr-c7hsb-clone-repo-pvbsk        clone-repo        2 minutes ago    1 minute   Succeeded
</code></pre></div>
<p>This tells us that the pipeline is running.
The <code>clone-repo</code> pipeline task has completely successfully and the <code>source-to-image</code> pipeline task is currently running.</p>
<p>Continue to rerun the command to check the status.  If the pipeline runs successfully, the description eventually should look like this:</p>
<div class="highlight"><pre><span></span><code>$ tkn pipelinerun describe picalc-pr-c7hsb
Name:              picalc-pr-c7hsb
Namespace:         default
Pipeline Ref:      build-and-deploy-pipeline
Service Account:   pipeline-account

Status

STARTED          DURATION    STATUS
12 minutes ago   2 minutes   Succeeded

Resources

 No resources

Params

 NAME             VALUE
 gitUrl           https://github.com/IBM/tekton-tutorial
 pathToYamlFile   kubernetes/picalc.yaml
 imageUrl         us.icr.io/gregd/picalc
 imageTag         1.0

Taskruns

 NAME                                      TASK NAME           STARTED          DURATION     STATUS
 picalc-pr-c7hsb-deploy-to-cluster-mwvfs   deploy-to-cluster   9 minutes ago    10 seconds   Succeeded
 picalc-pr-c7hsb-source-to-image-s8rrg     source-to-image     10 minutes ago   1 minute     Succeeded
 picalc-pr-c7hsb-clone-repo-pvbsk          clone-repo          12 minutes ago   1 minute     Succeeded
``` --&gt;

Let&#39;s view the status of our pipeline run

```bash
kubectl get pipelinerun

NAME              SUCCEEDED   REASON    STARTTIME   COMPLETIONTIME
picalc-pr-dqwqb   Unknown     Running   5s
</code></pre></div>
<p>The pipeline will be successful when <code>SUCCEEDED</code> is <code>True</code>.</p>
<div class="highlight"><pre><span></span><code>NAME              SUCCEEDED   REASON      STARTTIME   COMPLETIONTIME
picalc-pr-dqwqb   True        Succeeded   7m26s       4m49s
</code></pre></div>
<p>Check the status of the Kubernetes deployment.  It should be ready.</p>
<div class="highlight"><pre><span></span><code>$ kubectl get deploy picalc
NAME     READY   UP-TO-DATE   AVAILABLE   AGE
picalc   <span class="m">1</span>/1     <span class="m">1</span>            <span class="m">1</span>           9m
</code></pre></div>
<p>You can curl the application using its NodePort service.
First display the nodes and choose one of the node's external IP addresses.
Then display the service to get its NodePort.</p>
<div class="highlight"><pre><span></span><code>$ kubectl get nodes -o wide
NAME           STATUS   ROLES    AGE     VERSION       INTERNAL-IP    EXTERNAL-IP      OS-IMAGE             KERNEL-VERSION      CONTAINER-RUNTIME
<span class="m">10</span>.221.22.11   Ready    &lt;none&gt;   7d23h   v1.16.8+IKS   <span class="m">10</span>.221.22.11   <span class="m">150</span>.238.236.26   Ubuntu <span class="m">18</span>.04.4 LTS   <span class="m">4</span>.15.0-96-generic   containerd://1.3.3
<span class="m">10</span>.221.22.49   Ready    &lt;none&gt;   7d23h   v1.16.8+IKS   <span class="m">10</span>.221.22.49   <span class="m">150</span>.238.236.21   Ubuntu <span class="m">18</span>.04.4 LTS   <span class="m">4</span>.15.0-96-generic   containerd://1.3.3

$ kubectl get svc picalc
NAME     TYPE       CLUSTER-IP      EXTERNAL-IP   PORT<span class="o">(</span>S<span class="o">)</span>          AGE
picalc   NodePort   <span class="m">172</span>.21.199.71   &lt;none&gt;        <span class="m">8080</span>:30925/TCP   9m

$ curl <span class="m">150</span>.238.236.26:30925?iterations<span class="o">=</span><span class="m">20000000</span>
<span class="m">3</span>.1415926036
</code></pre></div>
<h4 id="debugging-a-failed-pipelinerun">Debugging a failed PipelineRun<a class="headerlink" href="#debugging-a-failed-pipelinerun" title="Permanent link">&para;</a></h4>
<p>Let's take a look at what a PipelineRun failure would look like.
Edit the PipelineRun yaml and change the gitUrl parameter to a non-existent Git repository to force a failure.
Then create a new PipelineRun and describe it after letting it run for a minute or two.</p>
<div class="highlight"><pre><span></span><code>$ kubectl create -f tekton/picalc-pipeline-run.yaml
pipelinerun.tekton.dev/picalc-pr-sk7md created

$ tkn pipelinerun describe picalc-pr-sk7md
Name:              picalc-pr-sk7md
Namespace:         default
Pipeline Ref:      build-and-deploy-pipeline
Service Account:   pipeline-account

Status

STARTED         DURATION     STATUS
<span class="m">2</span> minutes ago   <span class="m">41</span> seconds   Failed

Message

TaskRun picalc-pr-sk7md-clone-repo-8gs25 has failed <span class="o">(</span><span class="p">&amp;</span><span class="c1">#34;step-clone&amp;#34; exited with code 1 (image: &amp;#34;gcr.io/tekton-releases/github.com/tektoncd/pipeline/cmd/git-init@sha256:bee98bfe6807e8f4e0a31b4e786fd1f7f459e653ed1a22b1a25999f33fa9134a&amp;#34;); for logs run: kubectl -n default logs picalc-pr-sk7md-clone-repo-8gs25-pod-v7fg8 -c step-clone)</span>

Resources

 No resources

Params

 NAME             VALUE
 gitUrl           https://github.com/IBM/tekton-tutorial-not-there
 pathToYamlFile   kubernetes/picalc.yaml
 imageUrl         us.icr.io/gregd/picalc
 imageTag         <span class="m">1</span>.0

Taskruns

 NAME                               TASK NAME    STARTED         DURATION     STATUS
 picalc-pr-sk7md-clone-repo-8gs25   clone-repo   <span class="m">2</span> minutes ago   <span class="m">41</span> seconds   Failed
</code></pre></div>
<p>The output tells us that the <code>clone-repo</code> pipeline task failed.  The <code>Message</code> also tells us how to get the logs from the pod which was used to run the task:</p>
<div class="highlight"><pre><span></span><code><span class="k">for</span> logs run: kubectl -n default logs picalc-pr-sk7md-clone-repo-8gs25-pod-v7fg8 -c step-clone
</code></pre></div>
<p>If you run that <code>kubectl logs</code> command you will see that there is a failure trying to fetch the non-existing Git repository.</p>
<p>An even easier way to get the logs from a PipelineRun is to use the <code>tkn</code> CLI.</p>
<div class="highlight"><pre><span></span><code>tkn pipelinerun logs picalc-pr-sk7md-clone-repo-8gs25-pod-v7fg8 -t clone-repo
</code></pre></div>
<p>If you omit the <code>-t</code> flag then the command will get the logs for all pipeline tasks that executed.</p>
<p>You can also get the logs for the last PipelineRun for a particular Pipeline using this command:</p>
<div class="highlight"><pre><span></span><code>tkn pipeline logs build-and-deploy-pipeline -L
</code></pre></div>
<p>You should delete a PipelineRun when you no longer have a need to reference its logs.  Deleting the PipelineRun deletes the pods that were used
to run the pipeline tasks.</p>
<h3 id="10-check-it-out-in-openshift-console">10. Check it out in OpenShift Console<a class="headerlink" href="#10-check-it-out-in-openshift-console" title="Permanent link">&para;</a></h3>
<p>OpenShift provides a nice UI for the pipelines and the applications deployed. From the OpenShift console, click <strong>developer</strong> in the upper left drop-down to get to the developer view. Then click <strong>Topology</strong> to view your running app.</p>
<p><img alt="OpenShift Topology" src="images/openshift-topology.png" /></p>
<p>Click <strong>Pipelines</strong> to explore the pipline your created and explore the PipelineRuns</p>
<p><img alt="OpenShift Pipelines" src="images/openshift-pipelines.png" /></p>
<h2 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">&para;</a></h2>
<p>Tekton provides simple, easy-to-learn features for constructing CI/CD pipelines that run on Kubernetes. This tutorial covered the basics to get you started building your own pipelines. There are more features available and many more planned for upcoming releases.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2020 IBM Developer
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/ibm" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://twitter.com/ibmdeveloper" target="_blank" rel="noopener" title="twitter.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://www.linkedin.com/company/ibm/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://www.youtube.com/user/developerworks" target="_blank" rel="noopener" title="www.youtube.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://dev.to/ibmdeveloper" target="_blank" rel="noopener" title="dev.to" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M120.12 208.29c-3.88-2.9-7.77-4.35-11.65-4.35H91.03v104.47h17.45c3.88 0 7.77-1.45 11.65-4.35 3.88-2.9 5.82-7.25 5.82-13.06v-69.65c-.01-5.8-1.96-10.16-5.83-13.06zM404.1 32H43.9C19.7 32 .06 51.59 0 75.8v360.4C.06 460.41 19.7 480 43.9 480h360.2c24.21 0 43.84-19.59 43.9-43.8V75.8c-.06-24.21-19.7-43.8-43.9-43.8zM154.2 291.19c0 18.81-11.61 47.31-48.36 47.25h-46.4V172.98h47.38c35.44 0 47.36 28.46 47.37 47.28l.01 70.93zm100.68-88.66H201.6v38.42h32.57v29.57H201.6v38.41h53.29v29.57h-62.18c-11.16.29-20.44-8.53-20.72-19.69V193.7c-.27-11.15 8.56-20.41 19.71-20.69h63.19l-.01 29.52zm103.64 115.29c-13.2 30.75-36.85 24.63-47.44 0l-38.53-144.8h32.57l29.71 113.72 29.57-113.72h32.58l-38.46 144.8z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="assets/javascripts/vendor.53cc9318.min.js"></script>
      <script src="assets/javascripts/bundle.e9c9f54f.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: ".",
          features: ['navigation.instant'],
          search: Object.assign({
            worker: "assets/javascripts/worker/search.9c0e82ba.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>